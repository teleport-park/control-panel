<ng-container *ngTemplateOutlet="(service.instances$ | async)?.length ? instances : empty"></ng-container>

<ng-template #instances>
    <div class="row m-0">
        <div *ngFor="let item of (service.instances$ | async)"
             class="col-xl-3 col-lg-6 col-md-6 col-sm-12 col-12 instance">
            <control-panel-ui-item-card [item]="item" [class.unregistered]="!item.registered" class="light-theme">
                <div class="hardware-item_title">
                    <h4>{{item.display_name || item.name}}</h4>
                </div>
                <p  matTooltip="{{item.machine_token}}"
                    [matTooltipShowDelay]="1000"
                    matTooltipPosition="below">
                    <span class="bold">{{translateService.instant('TOKEN')}}:</span>
                    {{_transformToken(item.machine_token)}}
                </p>
                <p>
                    <span class="bold">{{translateService.instant('SERVER_ENABLED')}}:</span>
                    <mat-icon [ngClass]="{'offline': !item.enabled, 'online': item.enabled}">
                        {{item.enabled ? 'desktop_windows' : 'desktop_access_disabled'}}
                    </mat-icon>
                </p>
                <p>
                    <span class="bold">{{translateService.instant('REGISTERED')}}:</span>
                    <mat-icon [ngClass]="{'offline': !item.registered, 'online': item.registered}">
                        {{item.registered ? 'check' : 'clear'}}
                    </mat-icon>
                </p>
                <p>
                    <span class="bold">{{translateService.instant('CONTROLLER_CONNECTED')}}:</span>
                    <mat-icon [ngClass]="{'offline': !item.connected, 'online': item.connected}">
                        {{item.connected ? 'check' : 'clear'}}
                    </mat-icon>
                </p>
                <p>
                    <span class="bold">{{translateService.instant('IP')}}:</span>
                    {{item.ip_address || 'N/A' | translate}}
                </p>
                <p>
                    <span class="bold">{{translateService.instant('GAME')}}:</span>
                    {{item.game?.name || 'N/A' | translate}}
                </p>
                <p>
                    <span class="bold">{{translateService.instant('STATUS')}}:</span>
                    {{item.status ? (item.status.toUpperCase() | translate) : 'N/A' | translate}}
                </p>
                <div *ngIf="item.registered" class="action-button justify-content-between d-flex align-items-center mt-2">
                    <mat-slide-toggle color="success" (change)="toggle(item)" [checked]="item.enabled"><span
                            class="label">{{(item.enabled ? 'DISABLE_SERVER' : 'ENABLE_SERVER') | translate}}</span>
                    </mat-slide-toggle>
                    <div>
                        <a *ngIf="item.enabled" class="game-link mr-3" href="#"
                           (click)="$event.preventDefault(); getServerGames(item)">{{'ADMIN_MENU_GAMES' | translate}}</a>
                        <button mat-icon-button
                                matTooltip="{{'TABLE_EDIT' | translate}}"
                                [matTooltipShowDelay]="500"
                                matTooltipPosition="above"
                                color="primary" (click)="edit(item)">
                            <mat-icon>edit</mat-icon>
                        </button>
                        <button mat-icon-button
                                matTooltip="{{'TABLE_DELETE' | translate}}"
                                [matTooltipShowDelay]="500"
                                matTooltipPosition="above"
                                color="warn" (click)="remove(item)">
                            <mat-icon>delete</mat-icon>
                        </button>
                    </div>
                </div>
                <div *ngIf="!item.registered" class="actions">
                    <button mat-flat-button color="primary" *ngIf="!item.registered" (click)="registerHandler(item)">{{'REGISTER' | translate}}</button>
<!--                    <button mat-flat-button color="primary" *ngIf="!item.authorized" (click)="grant(item)">grant-->
<!--                    </button>-->
                </div>
            </control-panel-ui-item-card>
        </div>
    </div>
</ng-template>

<ng-template #empty>
    <control-panel-ui-empty></control-panel-ui-empty>
</ng-template>

<ng-template #registerForm let-data>
    <h4>{{'REGISTER' | translate}}</h4>
    <ng-container *ngTemplateOutlet="form"></ng-container>
    <button mat-flat-button color="primary" (click)="register(data)">{{'REGISTER' | translate}}</button>
</ng-template>

<ng-template #editForm let-data>
    <h4>{{'EDIT' | translate}}</h4>
    <ng-container *ngTemplateOutlet="form"></ng-container>
    <button mat-flat-button color="primary" (click)="submit(data)">{{'SAVE' | translate}}</button>
</ng-template>

<ng-template #form>
    <form [formGroup]="_form">
        <mat-form-field>
            <label>
                <input matInput placeholder="{{'NAME' | translate}}" formControlName="name">
            </label>
        </mat-form-field>
        <mat-checkbox formControlName="enabled">{{'ENABLED' | translate}}</mat-checkbox>
    </form>
</ng-template>

<control-panel-trigger [callBack]="service.refresh.bind(service)" [timerValue]="200"></control-panel-trigger>
